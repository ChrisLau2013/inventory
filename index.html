<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Inventory Counting</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- iOS Home Screen Icon -->
<link rel="apple-touch-icon" sizes="180x180" href="icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Inventory">

<style>
body { font-family:-apple-system,BlinkMacSystemFont,sans-serif; margin:0; }
header { background:#1e90ff; color:#fff; text-align:center; padding:14px; font-size:20px; position:sticky; top:0; }
main { padding:14px; }

input, select, button {
  width:100%;
  font-size:18px;
  padding:10px;
  margin-bottom:12px;
  border-radius:6px;
  box-sizing:border-box;
}

button { background:#1e90ff; color:#fff; border:none; }
button.secondary { background:#666; }

.hidden { display:none; }

#history { max-height:260px; overflow:auto; border-top:1px solid #ccc; }
table { width:100%; border-collapse:collapse; font-size:13px; }
th,td { border:1px solid #ccc; padding:5px; text-align:center; }
thead th { position:sticky; top:0; background:#eee; }

/* Location row */
.location-lock-row {
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:12px;
}
.location-lock-row select { flex:1; }

/* Lock button */
.lock-btn {
  font-size:14px;
  padding:10px 14px;
  border-radius:8px;
  background:#ccc;
  color:#333;
  white-space:nowrap;
}
.lock-btn.locked {
  background:#28a745;
  color:#fff;
}
.lock-btn.disabled {
  background:#ddd;
  color:#777;
}

/* Toast */
#toast {
  position:fixed;
  bottom:28px;
  left:50%;
  transform:translateX(-50%) translateY(20px);
  padding:14px 18px;
  border-radius:14px;
  font-size:15px;
  color:#fff;
  opacity:0;
  transition:.3s;
}
#toast.show { opacity:1; transform:translateX(-50%) translateY(0); }
#toast.success { background:#28a745; }
#toast.warn { background:#ff9800; }
</style>
</head>

<body>
<header>Inventory Counting</header>

<main>
<button id="fileBtn">Choose CSV File</button>
<div id="fileName">No file chosen</div>
<input type="file" id="fileInput" accept=".csv" hidden>

<div class="location-lock-row">
  <select id="locationSelect">
    <option value="">Select location</option>
    <option>Warehouse A</option>
    <option>Warehouse B</option>
    <option>Loading Bay</option>
  </select>

  <button type="button" id="lockLocationBtn" class="lock-btn disabled">
    ðŸ”“ Location Unlocked
  </button>
</div>

<select id="catalogSelect"></select>
<input id="search" placeholder="Search product">
<select id="productSelect"></select>

<input id="qtyInput" type="number" placeholder="Enter quantity">
<button id="saveBtn">Save Count</button>

<div id="history">
<table>
<thead>
<tr><th>Time</th><th>Product</th><th>Location</th><th>Qty</th></tr>
</thead>
<tbody id="historyBody"></tbody>
</table>
</div>
</main>

<div id="toast" class="success">Saved</div>

<script>
/* ---------- HAPTIC ---------- */
function haptic(type='light'){
  if(!navigator.vibrate) return;
  navigator.vibrate(type==='medium'?20:10);
}

/* ---------- DATA ---------- */
let data = JSON.parse(localStorage.getItem('inventory')) || [];
let locationLocked = false;

const locationSelect = document.getElementById('locationSelect');
const lockBtn = document.getElementById('lockLocationBtn');
const qtyInput = document.getElementById('qtyInput');
const historyBody = document.getElementById('historyBody');

/* ---------- TOAST ---------- */
function showToast(msg,type='success'){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.className=type+' show';
  setTimeout(()=>t.classList.remove('show'),2000);
}

/* ---------- LOCATION LOCK ---------- */
locationSelect.addEventListener('change',()=>{
  if(locationSelect.value){
    lockBtn.classList.remove('disabled');
  }else{
    locationLocked=false;
    lockBtn.className='lock-btn disabled';
    lockBtn.textContent='ðŸ”“ Location Unlocked';
  }
});

lockBtn.onclick=()=>{
  if(!locationSelect.value) return;
  locationLocked=!locationLocked;
  lockBtn.className='lock-btn'+(locationLocked?' locked':'');
  lockBtn.textContent=locationLocked?'ðŸ”’ Location Locked':'ðŸ”“ Location Unlocked';
  haptic(locationLocked?'medium':'light');
};

/* ---------- SAVE ---------- */
document.getElementById('saveBtn').onclick=()=>{
  if(!locationSelect.value || !qtyInput.value){
    showToast('Missing data','warn'); return;
  }

  data.push({
    time:new Date().toLocaleString(),
    location:locationSelect.value,
    qty:qtyInput.value
  });

  localStorage.setItem('inventory',JSON.stringify(data));
  updateHistory();
  qtyInput.value='';
  if(!locationLocked) locationSelect.value='';
  haptic('light');
  showToast('Saved');
};

function updateHistory(){
  historyBody.innerHTML='';
  data.slice().reverse().forEach(r=>{
    historyBody.innerHTML+=
      `<tr><td>${r.time}</td><td>-</td><td>${r.location}</td><td>${r.qty}</td></tr>`;
  });
}
updateHistory();
</script>
</body>
</html>
